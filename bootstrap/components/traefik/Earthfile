VERSION 0.8

IMPORT ../../.. AS core

# Changing the version above v28.0 make all IngressRoutes CRD to be invalid
# In requires to change the apiVersion: traefik.containo.us/v1alpha1 to apiVersion: traefik.io/v1alpha1
# After upgrading traefik, it seems like all the CustomResourceDefinition were not being updated on sub-vclusters wich make the helm upgrade to fail
deploy:
    FROM --pass-args core+deployer-image
    ARG tld=dev.formance.theweirdlab.me
    ARG version=28.1.0
    COPY values.yaml .
    RUN helm upgrade --install \
        --namespace kube-system \
        --create-namespace \
        --values values.yaml \
        --repo https://traefik.github.io/charts \
        --version $version \
        traefik traefik
        